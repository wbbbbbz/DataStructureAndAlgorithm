# 第 10 章 欧拉回路与欧拉路径

- 欧拉回路
  - 从一个点出发，沿着边行走，*经过每个边恰好一次*，之后再回到出发点
  - 有哈密尔顿回路不一定代表有欧拉回路，有欧拉回路不一定有哈密尔顿回路
  - 两种回路都不存在的图更多
  - 图论的开端

- 对于每一个点一定要进去一次，出去一次，那么相当于耗费两条边
  - 想找到欧拉回路，那么每个点都必须有进有出
  - 所以每个点的相连边数(即每个点的度)必须是偶数
  - 以上证明了有一个点的度不是偶数->图中不存在欧拉回路
  - 也就是图存在欧拉回路->每个点的度是偶数

- 图论必须先考虑是否联通
- 对于无向连通图(不连通肯定没有欧拉回路)
  - 每个点的度是偶数 == 图存在欧拉回路

- 证明每个点的度是偶数->图存在欧拉回路
  - 从任一点出发，先随便找一个环，如果这个环是原图，那么就是欧拉回路
  - 否则，剩下的边一定和找到的环相连，且所有顶点的度数依然是偶数，即依然存在环
  - 因为总度数是偶数，减去的环度数也是偶数，所以剩下的度数也一定是偶数
  - 并且两个相连的环，一定组成一个新环(走到新环的节点的时候，直接进入新环就行)
  - 并且找环的过程是可以嵌套的
  - 欧拉回路的构造的步骤

- 判断是否存在欧拉回路
  - 判断联通，并且所有度数都是偶数

- 哈密尔顿算法没有判断联通，是因为在回溯递归的时候相当于在判断联通了
  - 当然因为是指数级别的算法，所以可以进行提前判断的优化


- 求解欧拉回路三个算法
  - 回溯法，只不过条件是遍历所有的边。指数级别
    - 遍历时删去经过的边，回溯时加回
    - 指数级别
  - Fleury算法(贪心算法)
    - 遍历时删去经过边
    - 但是选择边的时候，如果有多条边的时候，不走桥！
    - 因为如果经过桥，然后把桥删去的话，图就会不连通了
    - 对每一个邻边，判断一下桥。但是桥是不能预处理的，因为每一次的桥都是删去了一些边而得到的
    - 所以是O((V+E)^2)级别，遍历时V+E，桥的判断也是V+E
    - 因为是联通图，所以可以写成E^2算法
    - *贪心算法时比较难设计的。如何贪是比较容易的，但是证明为什么贪了就对了是比较难的*
      - 必须证明贪心选择
    - 可以优化成ElogE
  - Hierholzer算法
    - 和构造性证明欧拉回路的步骤是一样的
    - 走出一个环的话，删去环，留下公共点，继续
    - O(V+E)
    - 递归和非递归都能完成，但是经典实现是非递归
    - 使用两个栈(实际上是一个栈)
      - curPath：记录从某一个起始点找到的环的路径
      - loop: 记录最终的欧拉路径
    - 选择随便一条边，压入栈，删掉边
      - 如果已经无路可走，那么就把curPath中的路径压入loop中
        - 现在随便找到的环一定是最终欧拉回路的一部分
      - 每一次提出的节点，如果还有路径的话，就说明这个点是与别的环的公共点
        - 可以先经过这个点，走别的环，这个环一定会回到这个点
      - 走到其他路径那就继续开始压栈，无路可走就弹栈
      - 虽然得到的是逆序的欧拉回路，但是顺序是无所谓的，所以loop不需要是一个栈，是一个数组就好
      - 每个边走一次，回退一次O(E)
    - 入栈出栈和节点更新的顺序很重要！
      - 每一次中途的弹栈都是某一个环的起点，需要被记录下来
- 图删除边的话，需要实现删除边的接口，并且准备深拷贝的代码！Cloneable

```java
int curv = 0;
// 1. 如果还有边(edges[i][j] == true)，那么就压栈
// 2. 如果没有边，就弹栈，记录结果
// 3. 如果栈空，那么就结束
curPath.push(curv);
while (!curPath.isEmpty()) {
    if (g.degree(curv) != 0) {
        curPath.push(curv);
        int w = g.adj(curv).iterator().next();
        g.removeEdge(curv, w);
        // System.out.println(curv + " " + w);
        curv = w;
    } else {
        eulerLoop.add(curv);
        curv = curPath.pop();
    }
}
```
- 拓展
  - 欧拉路径
    - 起始点和终止点可以不一样
    - 无向连通图中，除了两个点以外每个点的度数都是偶数==图存在欧拉路径
    - 奇数点是起始点和终止点
    - 证明是和欧拉回路一样
  - 递归写法
  - 回溯法，Fleury算法